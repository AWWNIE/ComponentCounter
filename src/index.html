<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Alt1—Read Current Username</title>
  <script src="https://www.alt1.gg/alt1.js"></script>
</head>
<body>
  <h1>Alt1: Capture Current RS3 Username</h1>
  <p>
    This app will attempt to read the “ Welcome to RuneScape, &lt;username&gt;.” text that appears in your game chat
    right after logging in. It uses OCR on a small region of the chat box.
  </p>

  <button id="readNameBtn">Read Username</button>
  <pre id="output">Username will appear here…</pre>

  <script>
    document.getElementById("readNameBtn").addEventListener("click", async () => {
      try {
        // 1. Locate the RuneScape client window
        const rsWindow = alt1.capture.getRsWindow();
        if (!rsWindow) {
          document.getElementById("output").innerText = "RuneScape window not found.";
          return;
        }

        // 2. Define a crop rectangle relative to the top of the chat box.
        //    When you first log in, the system message "Welcome to RuneScape, <username>."
        //    appears in the uppermost line of the chat panel. By default, that sits
        //    roughly 20 pixels above the bottom of the game window (at 100% interface scale),
        //    spanning about 300×30 pixels horizontally from the left edge. Adjust if needed.
        //
        //    NOTE: If you have moved your chat box or changed scaling,
        //    you may need to tweak these offsets.
        const chatCropWidth  = 300;
        const chatCropHeight = 30;
        const chatCropXOffset = 10;   // pixels from left edge of game window
        const chatCropYOffset = rsWindow.h - 180; 
        // (assuming default chat size; you can increase/decrease 180 until you cover the very bottom line)

        // 3. Capture that region of the screen
        const bmp = await alt1.capture.captureArea(
          rsWindow.x + chatCropXOffset,
          rsWindow.y + chatCropYOffset,
          chatCropWidth,
          chatCropHeight
        );

        // 4. Run OCR on the captured bitmap
        const ocrResult = await alt1.image.getOcrText(bmp);

        // 5. The OCR text should be something like: "Welcome to RuneScape, MyPlayerName."
        //    We can parse out the username by splitting on the comma and period.
        let username = "Not found";
        const prefix = "Welcome to runeScape, "; 
        // OCR may return lowercase or uppercase inconsistently. Normalize to lowercase for matching.
        const txtLower = ocrResult.trim().toLowerCase();
        if (txtLower.startsWith(prefix.toLowerCase())) {
          // Extract everything between comma and period
          const afterComma = ocrResult.split(",")[1] || "";
          username = afterComma.replace(".", "").trim();
        }

        document.getElementById("output").innerText =
          "OCR read:\n" + ocrResult + "\n\nParsed username:\n" + username;
      } catch (err) {
        console.error(err);
        document.getElementById("output").innerText =
          "Error while trying to read username:\n" + err;
      }
    });
  </script>
</body>
</html>
