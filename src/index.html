<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>RS3 Item Price Notifier</title>
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
    rel="stylesheet"
    integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
    crossorigin="anonymous"
  />
  <link
    rel="stylesheet"
    type="text/css"
    href="https://runeapps.org/nis/nis.css"
  />
  <link
    rel="stylesheet"
    type="text/css"
    href="https://runeapps.org/runeappslib.css"
  />
</head>

<body class="nis">
  <!-- ============================================= -->
  <!-- Step 1: Only show this “Discord settings” form at first -->
  <!-- ============================================= -->
  <div id="discordFormContainer" class="container my-5">
    <div class="row">
      <div class="col-12 col-md-6 offset-md-3">
        <div class="card shadow-sm">
          <div class="card-body">
            <h5 class="card-title text-center mb-4">Discord Settings</h5>

            <!-- Discord ID input -->
            <div class="mb-3">
              <label for="discordIdInput" class="form-label">Discord ID</label>
              <input
                type="text"
                id="discordIdInput"
                class="form-control"
                placeholder="Enter your Discord ID"
              />
            </div>

            <!-- Discord Webhook input -->
            <div class="mb-4">
              <label for="discordWebhookInput" class="form-label"
                >Discord Webhook URL</label
              >
              <input
                type="text"
                id="discordWebhookInput"
                class="form-control"
                placeholder="Enter your Webhook URL"
              />
            </div>

            <!-- Save button (disabled until both fields are non-empty) -->
            <button
              id="saveDiscordBtn"
              class="btn btn-primary w-100"
              disabled
            >
              Save
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ============================================= -->
  <!-- Step 2: All existing content is wrapped in this div and hidden by default -->
  <!-- It will be shown only after “Save” is clicked with valid inputs. -->
  <!-- ============================================= -->
  <div id="mainContent" style="display: none;">
    <ul class="itemList list-group">
      <li class="list-group-item header" data-show="history" title="Loading">
        Loading...
      </li>
      <li class="list-group-item total">
        Total Seren Spirits collected:
        <span id="total" style="font-weight:bold"></span>
      </li>
      <li
        class="list-group-item item"
        style="word-wrap:break-word;white-space: normal"
      >
        If this message is showing for an extended period of time, then the
        chatbox reader for Alt1 isn't working due to an update. Please be
        patient, and the issue will be fixed as soon as it can!
      </li>
    </ul>

    <div class="container">
      <div class="row fixed-bottom">
        <div class="col">
          <div class="row">
            <div class="col">
              <button
                class="nisbutton"
                data-bs-toggle="modal"
                data-bs-target="#settings"
                type="button"
              >
                Settings
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div
      class="modal nis"
      tabindex="-1"
      role="dialog"
      id="settings"
    >
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Settings</h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            >
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <div class="row">
              <div
                class="col"
                title="Allows the user to select the chat box the app should
                target."
              >
                <h6>Select Chat</h6>
              </div>
              <div class="col">
                <select class="chat">
                  <option value="">Select Chat</option>
                </select>
              </div>
            </div>
            <div class="row mt-3">
              <div class="col" title="Exports the current data as a CSV file.">
                <button class="nisbutton export">CSV Export</button>
              </div>
            </div>
            <div class="row mt-3">
              <div class="col">
                <button
                  class="nisbutton"
                  data-type="reset"
                  data-bs-toggle="collapse"
                  href="#resetApp"
                >
                  Factory Reset
                </button>
              </div>
            </div>
            <div class="row collapse danger" id="resetApp">
              <div class="col">
                <div class="row">
                  <div class="col text-center">
                    This will remove all saved data and set all settings to
                    default. This is irreversible!
                  </div>
                </div>
                <div class="row mt-2">
                  <div class="col">
                    <button
                      class="nisbutton clear"
                      data-type="reset"
                      data-bs-toggle="collapse"
                      href="#resetApp"
                    >
                      Yes
                    </button>
                  </div>
                  <div class="col">
                    <button
                      class="nisbutton"
                      data-bs-toggle="collapse"
                      href="#resetApp"
                    >
                      No
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>  
    </div>
  </div> <!-- end #mainContent -->

  <!-- ============================================ -->
  <!-- Step 3: Load your compiled index.ts (main.js) -->
  <!-- ============================================ -->
  <script src="./main.js"></script>

  <!-- ============================================ -->
  <!-- Step 4: Inline script to control “Save” logic  -->
  <!-- ============================================ -->
  <script>
    // Grab references to the form elements and main content
    const discordFormContainer = document.getElementById(
      "discordFormContainer"
    );
    const mainContent = document.getElementById("mainContent");
    const discordIdInput = document.getElementById("discordIdInput");
    const discordWebhookInput = document.getElementById(
      "discordWebhookInput"
    );
    const saveBtn = document.getElementById("saveDiscordBtn");

    // Helper: enable the Save button only if both inputs are non-empty
    function updateSaveButtonState() {
      const hasId = discordIdInput.value.trim().length > 0;
      const hasWebhook =
        discordWebhookInput.value.trim().length > 0;
      saveBtn.disabled = !(hasId && hasWebhook);
    }

    // Listen for any change/typing in either input
    discordIdInput.addEventListener("input", updateSaveButtonState);
    discordWebhookInput.addEventListener("input", updateSaveButtonState);

    // When “Save” is clicked:
    saveBtn.addEventListener("click", () => {
      const idValue = discordIdInput.value.trim();
      const webhookValue = discordWebhookInput.value.trim();

      // You could add extra validation here (e.g. URL format check for webhook),
      // but at minimum, we’ve ensured non-empty values above.

      // 1) Call your existing save‐to‐localStorage functions (from index.ts):
      updateSaveData({ discordID: idValue });
      updateSaveData({ discordWebhook: webhookValue });

      // 2) Hide the form and reveal the rest of the page
      discordFormContainer.style.display = "none";
      mainContent.style.display = "block";
    });

    // On page load, keep everything hidden until user clicks Save
    window.addEventListener("DOMContentLoaded", () => {
      // Make sure the initial state is correct:
      // - #mainContent = hidden
      // - Save button disabled
      mainContent.style.display = "none";
      saveBtn.disabled = true;
    });
  </script>
</body>
</html>
